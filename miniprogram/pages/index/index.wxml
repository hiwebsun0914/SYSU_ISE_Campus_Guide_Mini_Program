<view class="bg-wrapper">
  <!-- èƒŒæ™¯å›¾ -->
  <image class="bg-img"
         src="https://sysuzngcxy-1322240898.cos.ap-guangzhou.myqcloud.com/bg.jpg"
         mode="aspectFill" />

  <!-- å†…å®¹åŒº -->
  <view class="content">
    <!-- é¡¶éƒ¨æŒ‰é’®ï¼šå³ä¾§ğŸ—ºåœ°å›¾ï¼ˆæœ€å³ï¼‰ | å·¦ä¾§ğŸ–¼ç›¸å†Œ -->
    <view class="menu-icon" bindtap="toggleSidebar">â˜°</view>
    <view class="map-icon" bindtap="openMap">ï¼œ</view>

    <view class="logo-container">
      <image class="logo-img"
             src="https://sysuzngcxy-1322240898.cos.ap-guangzhou.myqcloud.com/logo.png"
             mode="widthFix" />
    </view>

    <view class="header">
      <text class="title">ğŸ“ æ¬¢è¿å‚åŠ æ ¡å›­å›¾é‰´æ‰“å¡æ´»åŠ¨</text>
    </view>

    <!-- ä¾§è¾¹æ  -->
    <view wx:if="{{sidebarVisible}}" class="sidebar-mask" bindtap="toggleSidebar">
      <view class="sidebar" catchtap="noop">
        <view class="sidebar-button" bindtap="goToRank">ğŸ† æ‰“å¡æ’å</view>
        <view class="sidebar-button" bindtap="goToConnect">ğŸ› ï¸ é—®é¢˜åé¦ˆ</view>
      </view>
    </view>

    <!-- ç›¸å†Œå¼¹å±‚ï¼ˆæ¥è‡ª /home/galleryï¼‰ -->
    <view wx:if="{{viewerVisible}}" class="viewer-mask" catchtouchmove="noop">
      <swiper class="viewer-swiper"
              indicator-dots="true"
              indicator-active-color="#ffffff"
              indicator-color="rgba(255,255,255,.35)"
              circular="true"
              autoplay="false"
              current="{{current}}"
              bindchange="onSwiperChange">
        <block wx:for="{{images}}" wx:key="*this">
          <swiper-item>
            <image class="viewer-img"
                   src="{{item}}"
                   mode="aspectFill"
                   bindtap="previewCurrent" />
          </swiper-item>
        </block>
      </swiper>
      <view class="viewer-pager">{{current + 1}} / {{images.length}}</view>
      <view class="viewer-close" bindtap="closeViewer">Ã—</view>
    </view>

    <!-- åœ°å›¾â€œç…§ç‰‡â€å¼¹å±‚ï¼ˆæ¥è‡ª /home/galleryï¼‰ -->
    <view wx:if="{{mapVisible}}" class="map-mask" catchtouchmove="noop">
      <image class="map-photo"
             src="{{mapPhotoLocal}}"
             mode="widthFix"
             show-menu-by-longpress
             bindtap="previewMapPhoto" />
      <view class="map-close" bindtap="closeMap">Ã—</view>
    </view>

    <!-- åˆ—è¡¨ï¼šæ–‡å­—+éª¨æ¶å…ˆæ˜¾ç¤ºï¼Œç¼©ç•¥å›¾å¼‚æ­¥åˆ° -->
    <view class="card-list" wx:if="{{showList}}">
      <block wx:for="{{locations}}" wx:key="id">
        <view class="card-horizontal js-card" data-id="{{item.id}}">
          <view class="img-wrap">
            <image class="card-img-left"
                   src="{{item.imageFullLocal || item.imageThumbLocal}}"
                   mode="aspectFill"
                   lazy-load="true" />
            <view wx:if="{{item.__skeleton}}" class="skeleton shimmer"></view>
          </view>

          <view class="card-info">
            <text class="card-title">{{item.name}}</text>
            <text class="card-meta">ç¼–å·ï¼š{{item.id}}</text>
            <text class="card-meta">ä½ç½®ï¼š{{item.position}}</text>
            <view class="btn-group">
              <button class="checkin-btn" bindtap="checkIn" data-id="{{item.id}}">æŸ¥çœ‹å¤§å›¾</button>
              <button class="detail-btn" bindtap="toggleDescription" data-id="{{item.id}}">
                {{item.expanded ? 'æ”¶èµ·è¯¦æƒ…' : 'å±•å¼€è¯¦æƒ…'}}
              </button>
            </view>
          </view>
        </view>

        <view wx:if="{{item.expanded}}" class="card-description">
          <rich-text nodes="{{item.description}}"></rich-text>
        </view>
      </block>
    </view>
  </view>
</view>
